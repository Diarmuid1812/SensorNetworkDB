<?php
/** login test */
// Initialize the session
session_start();

// Check if the user is logged in, if not then redirect him to login page
if(!isset($_SESSION["loggedin"]) || $_SESSION["loggedin"] !== true){
    header("location: usrLogin.php");
    exit;
}

    if(isset($_POST["backup"])&&$_POST["backup"]==="Utwórz backup")
    {
        $filename='database_backup_'.date('H-i-s_Y-m-d').'.sql';
        $result=exec('mysqldump database_name --password=your_pass --user=root --single-transaction >/var/backups/'.$filename,$output);

        if(empty($output)) $text = "Utworzono backup";
        else $text = "Wystąpił błąd, spróbuj ponownie później";
    }

?>


<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="teststyl.css">
<head>
    <meta charset="UTF-8">
    <title>Czujniki </title>

</head>
<body>
    <?php
    if($_SESSION["isPasswChanged"] !== true)
        echo "<div>
                <p>Nie zresetowałeś jeszcze wygenerowanego przez system hasła</p>
                <p>Zrób to, aby zwiększyć bezpieczeństow twojego konta.</p>
              </div>"
    ?>
    <div class="header"><h1>Sieć czujników temperatury i wilgotności</h1></div>
        <div class="column navig">
            <ul>
				<li><a href="interfejsGlowny.phtml">Strona główna</a></li>
                <li><a href="genReport.php">Raporty</a></li> <!-- domyslna strona po zalogowaniu -->
				<?php
                    if(isset($_SESSION["permission"])&&$_SESSION["permission"]===true)
                    {
                        echo '<li><a href="interfejsCzujniki.php">Zarządzaj czujnikami</a></li>';
				    }
                    if(isset($_SESSION["permission"])&&$_SESSION["permission"]===true)
                    {
                        echo '<li><a href="addUser.php">Zarządzaj użytkownikami</a></li>';
                    }
                ?>

                <li><a href="setResetPassword.php">Zresetuj hasło</a></li>
                <li><a href="usrLogout.php">Wyloguj się</a></li>
            </ul>
        </div>
    <div class="column content">

        <?php if(isset($_SESSION["permission"])&&$_SESSION["permission"]===true)
        {
            echo '<form action="<'.htmlspecialchars($_SERVER["PHP_SELF"]).'" method="post">
            <input type="submit" class="myButton" name="backup" value="Utwórz backup">
            </form>';
        }
        ?>
        <?php include "tabelaCzujnikow.php"?>
        <?php include "tabelaPomiar.php"?>
    </div>

</body>
</html>